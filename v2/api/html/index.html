<!doctype html>
<html ng-app="theWatcher" ng-controller="globalController">
 <title>http://thewatcher.io - The Watcher - {{ settings.application.title }}</title>
 <head>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-71038485-2', 'auto');
      ga('send', 'pageview');
    </script>

    <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.3/angular.min.js"></script>
    <script src="http://code.angularjs.org/1.5.3/angular-route.min.js"></script>
    <script src="/static/js/documentation.js"></script>
    <link rel="stylesheet" href="/static/css/style.css" />
 </head>


 <body>

    <h1>{{ settings.application.app_name }}</h1>
    <h2>{{ settings.application.title }}</h2>
    <h3> API Version {{ settings.api.version }}</h3>

    <table class="api_documentation">
        <tr><th colspan="3">API Documentation!</th></tr>
        <tr><td colspan="3">

        <p>The KDM API at <a href="http://api.thewatcher.io">http://api.thewatcher.io</a>
        is a RESTful API for campaign/settlement management in "Monster" by
        <a href="http://kingdomdeath.com" target="top">Kingdom Death</a>.</p>
        <p>The API is a fan-created and fan-maintained project that is not
        supported by, affiliated with or otherwise authorized by Kingdom Death.</p>
        <p>
            <a href="https://github.com/toconnell/kdm-manager" target="top">GitHub</a> |
            <a href="https://twitter.com/thewatcherapp" target="top">Twitter</a> |
            <a href="http://kdm-manager.blogspot.com/" target="top">Development blog</a>
        </p>

    </table>

    <table class="api_documentation public_routes">

        </td></tr>
        <tr><th colspan="3">PUBLIC ROUTES</th></tr>
        <tr>
            <td colspan="3">
                <p>
                    These routes <b>DO NOT</b> require authentication. Use them
                    to construct dashboard, "create new whatever" type views and
                    to look up game asset data that does not belong to any user.
                </p>
            </td>
        </tr>

        <tr class="ul">
            <th class="route">Route</th><th class="methods">Methods</th><th class="comment">Comment/Note</th>
        </tr>


        <tr class="ul">
            <td> <a href="/campaign">/campaign</a> </td>
            <td> POST </td>
            <td>
                <p>Accepts a "name" or "handle" parameter included in the body
                of the request (which should be JSON) and returns a JSON
                representation of the campaign:</p>
                <code>{"name": "People of the Lantern"}</code>
                <p>...gets you something like this:</p>
                <code>{"handle": "people_of_the_lantern","milestones":
                ["first_child", "first_death", "pop_15", "innovations_5",
                "game_over" ], "saviors": "1.3.1", "name": "People of the Lantern",
                "default": true, "principles": ["new_life", "death", "society",
                "conviction"], "always_available": { "location": ["Lantern
                Hoard"], "innovation": ["Language"]},"nemesis_monsters": [
                "butcher", "kings_man","the_hand","watcher"],"quarries": [
                "white_lion","screaming_antelope","phoenix", "beast_of_sorrow",
                "great_golden_cat", "mad_steed", "golden_eyed_king"],"type":
                "campaign_definition"}</code>
                <p>NB: this also works with handles, e.g.:</p>
                <code>{"handle": "people_of_the_stars"}</code>
            </td>
        </tr>

        <tr class="ul">
            <td> <a href="/login">/login</a> </td>
            <td> POST </td>
            <td>
                <p>        
                    The KD:M API uses JSON Web Tokens (<a
                    href="https://jwt.io/">https://jwt.io</a>) to manage user
                    sessions and user authentication.
                </p>
                <p> POST to this route with JSON containing user credentials in
                the body of the request to get a token:</p>
                <code>Authorization: {"username": "demo@kdm-manager.com", "password": 
                "l33th4x0r"}</code>
                <p>...if your credential checks out, you get a token and the the
                the user's ID (see below for working with users) back. Easy!</p>
            </td>
        </tr>

        <tr class="ul">
            <td> <a href="/monster">/monster</a> </td>
            <td> POST </td>
            <td>
                <p>
                    Accepts a "name" or "handle" parameter (via JSON) and
                    returns a JSON representation of a monster type game asset.
                    For example, POSTing to /monster with JSON such as this:
                </p>
                <code>{"name": "White Lion Lvl. 1"}</code>
                <p>...returns JSON like this: </p>
                <code>{"comment": "Lvl. 1", "handle": "white_lion", "name":
                "White Lion", "level": 1, "levels": 3, "sort_order": 0, "type":
                "quarry"}
                <p>Or, with a handle:</p>
                <code>{"handle": "manhunter"}</code>
                <p>...you get:</p>
                <pre><code>{
    "handle": "manhunter",
    "name": "Manhunter",
    "levels": 4,
    "sort_order": 103,
    "type": "nemesis",
    "selectable": false, 
    "misspellings": ["THE MANHUNTER", "MAN HUNTER"],
}</code></pre>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/new_settlement">/new_settlement</a></td>
            <td> GET </td>
            <td> Returns JSON representing available options for creating a new
            settlement, including expansions, pre-fab survivors, etc. Also
            includes subtitle/description elements. Use this to make "create
            new settlement" type views. </td>
        </tr>
        <tr class="ul">
            <td> <a href="/get_random_names/10">/get_random_names/&lt;count&gt;</a></td>
            <td> GET </td>
            <td> 
                <p>Returns <code>count</code> random names for each possible
                survivor sex.</p>
                <p><b>Important!</b>This method DOES NOT accept POST-type
                requests and <code>count</code> must be an integer!</p>
                <p>Output looks like this:</p>
                <pre><code>{
    "M": [
        "Fingal",
        "Pelagius",
        "Stark"
    ],
    "F": [
        "Hope",
        "Moana",
        "Rasha"
    ]
}
</code></pre>
            </td>
        </tr>
        <tr class="ul">
            <td> <a href="/settings.json">/settings.json</a> </td>
            <td> GET</td>
            <td> Not strictly a part of the API, but sometimes useful. Hit this
            route to download an attachement of settings.cfg as JSON. </td>
        </tr>
        <tr class="ul">
            <td> <a href="/settings">/settings</a> </td>
            <td> GET </td>
            <td> Retrieve settings.cfg as JSON</td>
        </tr>
        <tr class="ul">
            <td> <a href="/world">/world</a> </td>
            <td> GET </td>
            <td> Retrieve a JSON representation of aggregate/world stats.</td>
        </tr>

        <tr class="ul route_root">
            <th colspan="3"><b>Password reset routes:</b> use these two routes
            to build a password reset mechanism. </th>
        </tr>
        <tr class="ul">
            <td> /reset_password/request_code </td>
            <td> GET </td>
            <td> <p> Resetting a password is a two-part process: first, you request
            a recovery code by posting a registered user's email address to this
            route. This emails your user with a URL that they can use to reset
            their PW. <p>
            <p> To request a recovery code, simply POST some JSON containting the
            email of the user:</p>
            <code>{'username': 'demo@kdm-manager.com'}</code>
            <p>If this comes back 200, then the user has been emailed. Otherwise,
            if you get a non-200 response, it'll have specific reasons why it did
            not work.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /reset_password/reset </td>
            <td> GET </td>
            <td> <p> Before you POST to this route, you need a recovery code.<p>
            <p>Once you have it, include it with the user's email and new password
            in the body of your request:</p>
            <code>{'username': 'demo@kdm-manager.com', 'password': 's3cr3tP4ss',
            'recovery_code': '9FH3BKSNFI37FB476ZHABNDOWHEUSYAB234'}</code>
            <p>If your post comes back with a 200, then the user's password has
            been changed to the password you posted, and you can use it to log
            them in.</p>
        </tr>
    </table>


    <table class="api_documentation private_routes">
        <tr><th colspan="3">PRIVATE ROUTES</th></tr>
        <tr>
            <td colspan="3">
                <p>Private routes require an Authorization header including a
                JWT token.</p>
                <p>(See the documentation above for more info on how to POST
                user credentials to the <code>/login</code> route to get a
                token.)</p>
                <p>Generally speaking, when you access any private route, you 
                want your headers to look like this when using private routes:
                </p>
                <code>
                {
                    'content-type': 'application/json',
                    'Authorization': 'eyJhbGciOiJIUzI1NiIsInR5cCI6...'
                }
                </code>
                <p>Finally, keep in mind that tokens are extremely short-lived,
                so you should be prepared to refresh them frequently. See the
                section below on 'Authorization Token Management' for more info
                on checking/refreshing tokens.</p>
                <p><b>Important!</b> In order to support the CORS pre-flight
                checks that most browsers are going to auto-magically perform
                before POSTing to one of these routes, <u>all private routes
                supported by the KD:M API also support the <code>OPTIONS</code>
                method</u>, regardless of how they are documented below.</p>
            </td>
        </tr>

        <tr class="ul">
            <th class="route">Route</th><th class="methods">Methods</th><th class="comment">Comment/Note</th>
        </tr>

        <tr class="ul route_root">
            <th colspan="3"><b>Authorization Token Management:</b> once you've
            got an authorization token, you can work with it using these
            routes. Most failures from these routes are reported back as
            401's, since they concern authorization. </th>
        </tr>
        <tr class="ul">
            <td> /authorization/check</td>
            <td> GET,POST,OPTIONS </td>
            <td> 
            GET or POST to this endpoint to determine if your Authorization header
            is still valid or if it has expired.
            </td>
        </tr>
        <tr class="ul">
            <td> /authorization/refresh</td>
            <td> POST,OPTIONS</td>
            <td> 
            <p> Use the standard 'Authorization' header and POST an empty request to
            this route to recieve a new Auth token based on the previous one.</p>
            <p> On the back end, this route reads the incoming 'Authorization'
            header and, even if the JWT token is expired, will check the 'login'
            and 'password' (hash) keys: if they check out, you get a 200 and a
            brand new token.</p>
            <p> Finally, the KDM API does NOT use refresh tokens (it just feels 
            like overkill, you know?).</p>
            </td>
        </tr>


        <tr class="ul route_root">
            <th colspan="3"><b>Administrative views and data:</b> If your user
            has the 'admin' attribute, you can hit these routes to retrieve data
            about application usage, etc.</th>
        </tr>
        <tr class="ul">
            <td> /admin/view/panel</td>
            <td> GET </td>
            <td><p>API Admin panel. Uses HTTP basic auth (no cookies/no sessions)
            and requires a user have the 'admin' bit flipped on their user.</p></td>
        </tr>
        <tr class="ul">
            <td> /admin/get/user_data</td>
            <td> GET </td>
            <td><p>Retrieves a nice, juicy hunk of JSON re: recent users of the API.</p></td>
        </tr>
        <tr class="ul">
            <td> /admin/get/logs</td>
            <td> GET </td>
            <td><p>Dumps the contents of a number of system logs from the local
            filesystem where the API is running and represents them as JSON.</p></td>
        </tr>


        <tr class="ul route_root">
            <th colspan="3"><b>User Routes:</b> all routes for working directly with a user follow a <code>/user/&lt;action&gt;/&lt;settlement_id&gt;</code> convention. These routes are private and require authentication.</th>
        </tr>
        <tr class="ul">
            <td> /user/dashboard/&lt;user_id&gt; </td>
            <td> GET, OPTIONS</td>
            <td><p>This fetches a serialized version of the user that includes the
            <code>/world</code> output as well as a bunch of info about the user,
            including their friends, settlements they own or are playing in, etc.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /user/get/&lt;user_id&gt; </td>
            <td> GET, OPTIONS </td>
            <td><p>Retrieve a serialized version of the user who owns &lt;user_id&gt;,
            to include some additional usage and meta facts about that user.</p>
            <p>Like many of the <code>GET</code> routes supported by the KD:M API,
            this route will return user info whether you use <code>POST</code> or
            any other supported method.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /user/set/&lt;user_id&gt; </td>
            <td> POST, OPTIONS </td>
            <td> <p>This route supports the assignment of user-specified key/value
            attributes to the user object.</p><p>To set an attribute, include
            JSON in the body of the request that indicates the key/value to set.</p>
            Supported attribute keys include:
                <table class="embedded_table">
                    <tr><th>key</th><th>value</th></tr>
                    <tr><td class="key">current_settlement</td><td class="value">
                    OID of an existing,non-removed settlement.</td></tr>
                </table>
            Use multiple key/value pairs to set multiple attributes in a single
            request, e.g. <code>{"current_settlement": $oid, "current_session":
            $oid}</code>
            </p>
            <p><b>Important!</b> This route does not support the assignment of
            arbitrary keys and will completely fail any request that includes
            unsupported keys!</p>
            </td>
        </tr>





        <tr class="ul route_root">
            <th colspan="3"><b>Create Assets:</b> To create new assets (user, survivor, settlement),
            POST JSON containing appropriate params to the /new/&lt;asset_type&gt;
            route. Invalid or unrecognized params will be ignored!</th>
        </tr>
        <tr class="ul">
            <td> /new/user </td>
            <td> POST, OPTIONS</td>
            <td> <p>Include the valid email address and password in the JSON body
            of your POST to create a new user:</p>
            <code>{'username': 'demo@kdm-manager.com', 'password': 'tehH4x0r'}</code>
            <p> If you get a 200 back from the API, the user was created without
            issue. Otherwise, this route produces some pretty explicit feedback
            when it returns anything other than a 200.</p>
            <p><b>Important!</b> This is <u>not a private route</u> and you do
            not have to include a JWT in your header for this endpoint to work.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /new/settlement </td>
            <td> POST, OPTIONS </td>
            <td> <p>Use 'handle' values from the <code>/new_settlement</code>
            route (see above) as params, like this:</p>
            <code> {"campaign": "people_of_the_lantern", "expansions": ["dung_beetle_knight",
            "lion_god"], "survivors": ["adam", "anna"], "name": "Chicago",
            "special": ["create_first_story_survivors"]}
            </code>
            <p>If successful, this route returns a serialized version of the new settlement,
            including its OID, as JSON.</p>
            <p>The following <code>special</code> values are supported by the API:</p>
                <table class="embedded_table">
                    <tr><th>value</th><th>result</th></tr>
                    <tr>
                     <td class="key">create_first_story_survivors</td>
                     <td class="value">Creates two male and two female survivors,
                     assigns them names and places Founding Stones and Cloths in
                     Settlement Storage.</td>
                    </tr>
                    <tr>
                     <td class="key">create_seven_swordsmen</td>
                     <td class="value">Creates seven random survivors with the
                    'Ageless' and Sword Mastery A&Is. </td>
                    </tr>
                </table>
            <p><b>Important!</b> Unsupported <code>special</code> values are
            ignored.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> <a id="newSurvivor"></a>/new/survivor </td>
            <td> POST, OPTIONS</td>
            <td> <p>This works differently from <code>/new/settlement</code> in
            a number of significant ways.</p>
            <p> In a nutshell, the basic idea here is that the only required key
            in the JSON you POST to this route is an object ID for the settlement
            to which the survivor belongs:</p>
            <code>{'settlement': '59669ace4af5ca799c968c94'}</code>
            <p> Beyond that, you are free to supply any other attributes of the
            survivor, so long as they comply with the data model for survivors.</p>
            <p> Consult the <a href="/#survivorDataModel">Survivor Data Model (below)</a> for a
            complete reference on what attributes of the survivor may be set at
            creation time.</p>
            <p>As a general piece of advice, it typically makes more sense to
            just initialize a new survivor with defaults and then operate on it
            using the routes below.</p>
            <p><b>Important!</b>Just like the <code>/new/settlement</code> route,
            a successful POST to the <code>/new/survivor</code> route will return
            a serialized version (i.e. JSON) of the new survivor, complete with
            the <code>sheet</code> element, etc.</p>
            </td>
        </tr>



        <tr class="ul route_root">
            <th colspan="3">
            <p><b>Settlement Routes:</b> all routes for working directly with a
            settlement follow a <code>/settlement/&lt;action&gt;/&lt;settlement_id&gt;
            </code> convention.</p>
            <p>These routes are private and require authentication.</p>

            <p>Many operations below require asset handles.
            Asset handles may be found in the settlement's <code>game_assets</code>
            element, which contains dictionaries and lists of assets that are
            available to the settlement based on its campaign, expansions, etc.</p>
            <p>Typical settlement JSON looks like this:</p>
            <pre><code>
            {
                "user_assets": {...},
                "meta": {...},
                "sheet": {...},
                "game_assets": {
                    "milestones_options": {...},
                    "campaign": {...},
                    "weapon_specializations": {...},
                    "locations": {...},
                    "innovations": {...},
                    "principles_options": {...},
                    "causes_of_death": {...},
                    "quarry_options": {...},
                    "nemesis_options": {...},
                    "eligible_parents": {...},
                    ...
                },
            }
            </code></pre>

            <p><b>Important!</b> As indicated elsewhere in this documentation,
            asset handles will never change. Asset names are subject to change,
            and, while name-based lookup methods are supported by various routes,
            using names instead of handles is not recommended.</p>
            </th>
        </tr>
 

        <!-- settlement GET -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Settlement data retrieval:</b>
            The routes in this section only support the GET method and are meant
            to be used to retrieve certain types of Settlement data. </td>
        </tr>

        <tr class="ul">
            <td> /settlement/get/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td> <p> Retrieve a serialized version of the settlement associated
            with &lt;settlement_id&gt; (to include all related user and game
            assets, including survivors).</p>
            <p><b>Important!</b> Depending on the number of expansions, survivors,
            users, etc. involved in a settlement/campaign, this one can take a
            long time to come back (over 2.5 seconds on Production hardware).
            YHBW</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_game_assets/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td><p>Retrieve a serialized version of just the settlement that only
            includes the settlement's <code>game_assets</code> element.
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_sheet/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td><p>Retrieve a serialized version of just the settlement that only
            includes the <code>sheet</code> element.
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_campaign/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td><p>Retrieve a serialized version of the settlement where the
            <code>user_assets</code> element includes the <code>groups</code>
            list, among other things, and is intended to be used in creating
            'campaign' type views.</p>
            <p>Much like the big <code>get</code> route for settlements, this one
            can take a while to come back, e.g. two or more seconds for a normal
            settlement. YHBW.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/get_event_log/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td> <p>Retrieve all settlement event log entries (in a giant hunk
            of JSON). For higher LY settlements, this can get really huge.</p>
            <p>Definitely consider loading this one AFTER you have rendered the
            rest of the view. </p>
            </td>            
        </tr>
        <tr class="ul">
            <td> /settlement/get_innovation_deck/&lt;settlement_id&gt; </td>
            <td> GET </td>
            <td> Retrieve the settlement's current innovation deck (as an array).</td>
        </tr>


        <tr>
            <td class="subsection_header" colspan="3"><b>Settlement attributes:</b>
            attributes such as Survival Limit, Population and Death Count are more
            or less automatically tracked by the API, but you can use these routes
            to modify them directly, if necessary. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_name/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td><p>POST some JSON whose body contains the key 'name' and whatever the
            new name is going to be as that key's value to change the settlement's
            name:</p>
            <code>{'name': 'The Black Lantern'}</code>
            <p><b>Important!</b> Submitting an empty string will cause the API to
            default the settlement's name to "UNKNOWN". There are no technical
            reasons (e.g. limitations) for this, but it breaks the display in most
            client apps, so null/empty names are forbidden.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_attribute/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>POST some basic JSON containing an 'attribute' and a 'value'
            key where 'attribute' is an integer settlement attrib and 'value' is
            the new value:</p>
            <code>{'attribute': 'survival_limit', 'value': 3}</code>
            <p> This route also supports incrementing the <code>population</code>
             and <code>death_count</code> attributes. </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_attribute/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>POST some JSON containing an 'attribute' and a 'modifier'
            key where 'attribute' is an integer settlement attrib and 'mofier' is
            how much you want to increment it by:</p>
            <code>{'attribute': 'death_count', 'modifier': -1}</code>
            <p> This route also supports incrementing the <code>survival_limit
            </code> and <code>death_count</code> routes.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_population/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>POST some JSON containing the key 'modifier' whose value is
            an integer that you want to add to the settlement's population
            number.<p>
            <p>This works basically identically to the <code>update_attribute</code>
            route, so considering using that route instead. </p>
            <p>For example, this JSON would add two to the settlement's
            population number:</p>
            <code>{'modifier': 2}</code>
            <p>POST negative numbers to decrease.</p>
            <p><b>Important!</b> Settlement population can never go below zero,
            so any 'modifier' values that would cause this simply cause the
            total to become zero.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_survivors/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
                <p>Use this route to update a specific group of survivors, e.g.
                Departing survivors.</p>
                <p>POST some JSON including the type of survivors to include,
                the attribute to modify, and the modifier:</p>
                <code>{include: 'departing', attribute: 'Insanity', modifier: 1}</code>
                <p><b>Important!</b> This route currently only supports the
                <code>include</code> value 'departing' and will error/fail/400 on
                literally anything else.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_inspirational_statue/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
                <p>Set the settlement's <code>inspirational_statue</code> attrib
                by POSTing a Fighting Art handle to this route:</p>
                <code>{'handle': 'leader'}</code>
                <p>This route will actually check out the handle and barf on you
                if you try to POST an unrecognized FA handle to it. YHBW.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_lantern_research_level/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
                <p>Set the Settlement's Lantern Research Level with some basic
                JSON:</p>
                <code>{'value': 3}</code>
                <p>This route is preferably to a generic attribute setting route
                becuase it a.) ignores values over 5 and b.) forces the attrib,
                which is not part of the standard data motel, to exist if it does
                not.</p>
                <p>Definitely use this instead of <code>set_attribute</code>.</p>
            </td>
        </tr>


        <!-- expansion controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Expansion content
            management:</b> add and remove expansion content. These methods
            require posting lists of expansion content handles. </td>
        </tr>

        <tr class="ul">
            <td> /settlement/add_expansions/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> Add expansions to a settlement by POSTing a list of expansion
            handles. The body of your post should be a JSON-style list: 
            <code>{'expansions': ['beta_challenge_scenarios','dragon_king']}</code>
            <p>
            Note that this route not only updates the settlement sheet, but also
            adds/removes timeline events, updates the settlement's available game
            assets (e.g. items, locations, etc.).
            </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_expansions/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> Remove expansions from a settlement by POSTing a list of
            expansion handles. The body of your post should be a JSON-style 
            list: 
            <code>{'expansions': ['manhunter','gorm','spidicules']}</code>
            <p>
            Note that this route not only updates the settlement sheet, but also
            adds/removes timeline events, updates the settlement's available game
            assets (e.g. items, locations, etc.).
            </p>
            <p><b>Important!</b> We're all adults here, and the KDM API will
            <i>not</i> stop you from removing expansion handles for expansions
            that are required by your settlement's campaign. If you want to
            prevent users from doing this, that's got to be part of your UI/UX
            considerations.</p>
            </td>
        </tr>


        <!-- monster controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Monster management:</b>
            update the settlement's quarries, current quarry, nemesis info,
            etc. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_current_quarry/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>This route sets the settlement's 'current_quarry' attribute,
            which is the monster that the settlement's Departing Survivors are
            currently hunting.</p><p>POST some simple JSON containing a monster
            name (do not use handles for this):</p>
            <code>{'current_quarry': 'White Lion Lvl 2'}</code>
            <p>...or, the monster is unique:</p>
            <code>{'current_quarry': 'Watcher'}</code>
            <p><b>Important!</b> You're typically going to want to pull monster
            names from the settlements' <code>game_assets -> defeated_monsters</code>
            list (which is a list of monster names created for the settlement
            based on expansion content, etc.)</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_defeated_monster/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>POST a 'monster' string to this route to add it to the
            settlement's list of defeated monsters:</p>
            <code>{'monster': 'White Lion (First Story)}</code> or
            <code>{'monster': 'Flower Knight Lvl 1'}</code>
            <p><b>Important!</b> Watch the strings on this one and try to avoid
            free text: if the API cannot parse the monster name and match it to
            a known monster type/name, this will fail.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_defeated_monster/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td><p>POST a 'monster' string to this route to remove it from the
            settlement's list of defeated monsters, i.e. the <code>sheet.defeated_monsters</code>
            array/list: </p>
            <code>{'monster': 'Manhunter Lvl 4'}</code>
            <p>Attempts to remove strings that do NOT exist in the list will
            not fail (i.e. they will be ignored and fail 'gracefully').</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_monster/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <P>Use this route to add quarry or nemesis type monsters to the
            settlement. POST some JSON containing the handle of the monster to
            add it:</p>
            <code>{'handle': 'flower_knight'}</code>
            <p>The API will determine whether the monster is a nemesis or a quarry
            and add it to the appropriate list. For nemesis monsters, use the
            <code>/settlement/update_nemesis_levels</code> route (below) to manage
            the checked/completed levels for that nemesis.</p>
            <p>Make sure to check the settlement JSON <code>game_assets.monsters</code>
            and use the correct handle for the desired monster.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_monster/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td><p>POST some JSON containing a quarry or nemesis type monster handle
            to remove it from the settlement's list:</p>
            <code>{'handle': 'sunstalker'}</code>
            <p>The API will determine whether the monster is a quarry or a nemesis.
            When a nemesis monster is removed, its level detail is also removed.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_nemesis_levels/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
             <p>Use this method to update the Settlement sheet's <code>nemesis_encounters</code>
             dictionary, i.e. to indicate that a nemesis encounter has occurred.</p>
             <p>A typical dictionary might look like this:</p>
             <code>        "nemesis_encounters": {"slenderman": [], "butcher": [1,2]}</code>
             <p>In this example, the settlement has (somehow) encountered a
             a level 1 Butcher, but has not yet encountered a Slenderman.</p>
             <p>To update the dictionary, POST some JSON that includes the
             nemesis monster's handle and the levels that are complete.</p>
             <p>POST this JSON to reset/undo/remove Butcher encounters:<p>
             <code>{"handle": "butcher", "levels": []}</code>
             <p>POST this JSON to record an encounter with a level 1 Manhunter:</p>
             <code>{"handle": "manhunter", "levels": [1]}</code>
            </td>
        </tr>

        <!-- principle/milestone -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Principles and Milestones:</b>
            routes for setting/unsetting principles and settlement Milestones.</td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_milestone/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
                <p>POST a milestone handle (get it from <code>game_assets</code>
                to this route to add it to the settlement's list of milestones:</p>
                <code>{handle: 'game_over'}</code><p>...or...</p>
                <code>{handle: 'innovations_5'}
                <p>This endpoint will gracefully fail and politely ignore dupes.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_milestone/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
                <p>POST a milestone handle (get it from <code>game_assets</code>
                to this route to remove it from the settlement's list of
                milestones:</p>
                <code>{handle: 'pop_15'}</code><p>...or...</p>
                <code>{handle: 'first_death'}
                <p>This endpoint will gracefully fail and politely ignore
                attempts to remove handles that are not present.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_principle/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>POST some JSON to this route to set or unset a settlement
            principle. Request the handle of the principle and the election you
            want to make:</p>
            <pre><code>
            {
                'principle': 'conviction',
                'election': 'romantic',
            }</code></pre>
            <p>This route has a couple of unusual behaviors to note:
            <ul>
                <li>It requires both keys (i.e. you will get a 400 back if you
                POST any JSON that does not include both).</li>
                <li>It will accept a Boolean for 'election', because this is how
                you 'un-set' a principle.</li>
            </ul>
            </p>
            <p> To un-set a principle, simply post the principle handle and set
            the 'election' key to 'false':</p>
            <code>{'principle': 'new_life', 'election': false}</code>
            <p> <b>Important!</b> Adding principles to (or removing them from) a
            settlement automatically modifies all current survivors, in many
            cases. Be sure to refresh any survivor info after POSTing JSON to
            this route!</p>
            </td>
        </tr>



        <!-- timeline controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Timeline controls:</b>
            use these routes to manage the settlement's timeline. These are
            probably the most complicated controls in the API, so read the docs
            carefully! </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_timeline_event/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>Adding a timeline event to a settlement's timeline requires a
            fairly specific bit of JSON. To add, for example, a settlement event,
            you need to post JSON that looks like this:</p>
            <code>{'type': 'settlement_event', 'ly': 3, 'handle': 'core_haunted',
            'name': 'Haunted', 'user_login': 'dev@kdm-manager.com'}</code>
            <p>Event names, types, handles, etc. can be found in the settlement's
            <code>game_assets -> events</code> (which is a dictionary of
            settlement and story events).</p>
            <p>Adding showdown type events works similarly:<p>
            <code>{'type': 'showdown_event', 'name': 'White Lion Lvl 1', 
            'ly': 4, 'user_login': 'user@whatever.com'}</code>
            <p>...or, for a special showdown:</p>
            <code>{'type': 'special_showdown', 'name': 'Watcher', 'ly': 20,
            'user_login': 'qa@kdm-manager.com'}</code>
            <p>Here is a list of accepted event 'type' values: 
            <ul>
                <li><code>showdown_event</code></li>
                <li><code>special_showdown</code></li>
                <li><code>nemesis_encounter</code></li>
                <li><code>settlement_event</code></li>
                <li><code>story_event</code></li>
            </ul>
            <b>Important!</b> Events without handles may be added, which means
            that you may absolutely add an event that <i>does not</i> come from
            the settlement's <code>game_assets -> events</code>. Events with
            neither a name nor a handle may not be added, however.
            </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_timeline_event/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>Works just like the <code>add_timeline_event</code> method,
            except in reverse. POST some JSON describing a timeline event
            that exists on the settlement's timeline to remove it:</p>
            <code>{'type': 'settlement_event', 'ly': 3, 'handle': 'core_haunted',
            'name': 'Haunted', 'user_login': 'dev@kdm-manager.com'}</code>
            <p>Since the <code>add_timeline_event</code> method allows for events
            without <code>handle</code> attributes (i.e. since it will accept
            JSON with a <code>name</code> and no <code>handle</code>), events
            may be removed using only their name and Lantern Year (<code>'ly'
            </code>) attribute:</p>
            <code>{'type': 'nemesis_encounter', 'name': 'Butcher Lvl 1', 'ly': 4,
            'user_login': 'user@whatever.com'}</code>
            </td>
        </tr>


        <!-- location controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Locations:</b>
            manage settlement locations and location levels.</td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_location/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p> POS aa location <code>handle</code> to this route to add
            it to the settlement's Locations:</p>
            <code>{'handle': 'bome_smith'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_location/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>This is basically the reverse of <code>add_location</code>
            and works nearly identically. POST a JSON representation of a 
            Location handle to remove it from the settlement's list:</p>
            <code>{'handle': 'barber_surgeon'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_location_level/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>For Locations that have a level (e.g. the People of the 
            Sun's 'Sacred Pool'), you may set the Location's level by posting
            the <code>handle</code> of the location and the desired level:</p>
            <code>{'handle': 'sacred_pool', 'level': 2}</code>
            </td>
        </tr>


        <!-- Innovation controls -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Innovations:</b>
            manage settlement innovations and innovation levels.</td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_innovation/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p> POST an Innovation <code>handle</code> to this route to add
            it to the settlement's Innovations:</p>
            <code>{'handle': 'hovel'}</code>
            <p>...or:</p><code>{'handle': 'mastery_club'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_innovation/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>This is basically the reverse of <code>add_innovation</code>
            and works nearly identically. POST a JSON representation of an 
            Innovation handle to remove it from the settlement's list:</p>
            <code>{'handle': 'mastery_club'}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_innovation_level/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>For Innovations that have a level (e.g. the Slenderman's 'Dark
            Water Research'), you may set the Innovation's level by posting
            the <code>handle</code> of the innovation and the level:</p>
            <code>{'handle': 'dark_water_research', 'level': 2}</code>
            </td>
        </tr>


        <!-- misc -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Other:</b>
            update the settlement's endeavor token count, lost settlements and
            other miscellaneous Settlement attributes. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/update_endeavor_tokens/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
            <p>Use this route to change a settlement's endeavor token count.</p>
            <p>POST some JSON containing the number to modify by:</p>
            <code>{"modifier": 2}</code>
            <p>The above code would add two to the settlement's current total,
            whereas the code below would decrement by one:</p>
            <code>{"modifier": -1}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_lost_settlements/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td>
            <p>Use this route to set a settlement's Lost Settlements total.</p>
            <p>POST some JSON containing the new value to set it to:</p>
            <code>{"value": 2}</code>
            <p>The above code would set the settlement's Lost Settlements total
            to two; negative numbers will default to zero. </p>
            </td>
        </tr>


        <!-- meta updates, e.g. logs, notes, etc. -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Meta and admin controls:</b>
            manage settlement meta data, including adding/removing settlement notes,
            changing the list of settlement admins, etc. </td>
        </tr>
        <tr class="ul">
            <td> /settlement/add_settlement_note/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> Documentation coming soon! </td>
        </tr>
        <tr class="ul">
            <td> /settlement/rm_settlement_note/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> Documentation coming soon! </td>
        </tr>
        <tr class="ul">
            <td> /settlement/set_last_accessed/&lt;settlement_id&gt; </td>
            <td> POST </td>
            <td> <p>This endpoint allows you to set the settlement's <code>last_accessed</code>
            attribute, which is used in dashboard reporting, etc. </p>
            <p>POSTing an empty JSON payload to this will cause the settlement's <code>
            last_accessed</code> value to be set to now.</p>
            </td>
        </tr>




        <tr class="ul route_root">
            <th colspan="3">
                <a id="survivorDataModel"></a>
                <p> <b>Survivor Routes:</b> all routes for working directly with
                an individual survivor follow a <code>
                /settlement/&lt;action&gt;/&lt;settlement_id&gt;</code> convention.</p>

                <p>Like settlement management routes, these routes are private, require
                authentication and accept the <code>OPTIONS</code> requests method.</p>

                <p><b>Important!</b> Any POST to any of these routes can also
                include the optional parameter <code>{"serialize_on_response": true}
                </code>. Including this param will get you a serialized version
                of the survivor as part of your response.</p>



            </th>
        </tr>

        <tr>
            <td class="subsection_header" colspan="3"><b>Survivor Data Model:</b><br/><br/>
                <table class="data_model_table">
                <tr><th>key</th><th>R/O</th><th>&nbsp; type &nbsp;</th><th width="40%">description</th><th>related endpoints</th></tr>
                <tr><td class="key">email</td><td>O</td><td>str</td><td>Defaults to the creator's login.</td></tr>
                <tr><td class="key">born_in_ly</td><td>O</td><td>int</td><td>Defaults to current LY.</td></tr>
                <tr><td class="key">settlement</td><td><b>R</b></td><td>OID</td><td>This must be set to a valid settlement OID at creation time and may never be changed. See <a href="#newSurvivor"><code>/new/survivor</code></a> above for more info on creating survivors.</td><td class="mono"></td></tr>
                <tr><td class="key">public</td><td>O</td><td>bool</td><td>Defaults to Boolean false. Submitting anything that evaluates to Boolean true will be treated as such.</td><td class="mono">toggle_boolean</td></tr>
                <tr><td class="key">name</td><td>O</td><td>str</td><td></td><td class="mono">set_name</td></tr>
                <tr><td class="key">sex</td><td>O</td><td>str</td><td>At creation time, this can be set to 'M', 'F' or 'R' (for random). Defaults to 'R' during creation if not specified in the POST body.</td><td class="mono">set_sex</td></tr>
                <tr><td class="key">survival</td><td>O</td><td>int</td><td></td><td class="mono">update_survival set_survival</td></tr>
                <tr><td class="key">hunt_xp</td><td>O</td><td>int</td><td></td></tr>
                <tr><td class="key">Insanity</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Head</td><td>O</td><td>int</td><td></td></tr>
                <tr><td class="key">Arms</td><td>O</td><td>int</td><td></td></tr>
                <tr><td class="key">Body</td><td>O</td><td>int</td><td></td></tr>
                <tr><td class="key">Waist</td><td>O</td><td>int</td><td></td></tr>
                <tr><td class="key">Legs</td><td>O</td><td>int</td><td></td></tr>
                <tr><td class="key">Courage</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Understanding</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">affinities</td><td>O</td><td>dict</td><td>Rather than setting this at creation time, consider using <code>upfate_affinities</code> route after creation to set this, unless you really know what you're doing</td><td class="mono">update_affinities set_affinity</td></tr>
                <tr><td class="key">departing</td><td>O</td><td>bool</td><td></td><td class="mono">set_status_flag</td></tr>
                <tr><td class="key">bleeding_tokens</td><td>O</td><td>int</td><td></td><td class="mono">update_bleeding_tokens set_bleeding_tokens</td></tr>
                <tr><td class="key">max_bleeding_tokens</td><td>O</td><td>int</td><td>Defaults to 5.</td><td class="mono">set_attribute</td></tr>
                <tr><td class="key">Movement</td><td>O</td><td>int</td><td>Defaults to 5.</td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Accuracy</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Strength</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Evasion</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Luck</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">Speed</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">attribute_detail</td><td>O</td><td>dict</td><td></td><td class="mono">set_attribute_detail</td></tr>
                <tr><td class="key">Weapon Proficiency</td><td>O</td><td>int</td><td></td><td class="mono">set_attribute update_attribute</td></tr>
                <tr><td class="key">weapon_proficiency_type</td><td>O</td><td>str</td><td>handle</td><td class="mono">set_weapon_proficiency_type</td></tr>
                <tr><td class="key">abilities_and_impairments</td><td>O</td><td>list</td><td>Needs a list of handles from the settlement's <code>game_assets</code> element, e.g. <code>{'abilities_and_impairments': ['ageless','mastery_sword']}</code> or similar.</td><td class="mono">add_game_asset rm_game_asset</td></tr>
                <tr><td class="key">cursed_items</td><td>O</td><td>list</td><td>List of handles</td><td class="mono">add_cursed_item rm_cursed_item</tr>
                <tr><td class="key">disorders</td><td>O</td><td>list</td><td>List of handles</td><td class="mono">add_game_asset, rm_game_asset</td></tr>
                <tr><td class="key">favorite</td><td>O</td><td>list</td><td>list of user emails, i.e. users who have favorited the survivor</td><td class="mono">add_favorite rm_favorite</td></tr>
                <tr><td class="key">fighting_arts</td><td>O</td><td>list</td><td>List of handles</td><td class="mono">add_game_asset rm_game_asset</td></tr>
                <tr><td class="key">fighting_arts_levels</td><td>O</td><td>list</td><td>dictionary where each key is a Fighting Art handle whose value is an array, e.g. <code>{'silk_surgeon': [1,2]}</code></td><td class="mono">toggle_fighting_arts_level</td></tr>
                <tr><td class="key">epithets</td><td>O</td><td>list</td><td>list of handles</td></tr>
                </table>

                <p><b>Important!</b> There are certain endpoints below that may
                add additional attributes to a survivor record, e.g. <code>
                controls_of_death</code>, <code>set_retired</code>, etc.</p>

                <p>Attributes such as <code>dead</code> and <code>retired</code>
                are not part of the baseline data model, i.e. they are not part
                of the survivor record when it is created. YHBW</p>

            </td>
        </tr>

        <tr>
            <td class="subsection_header" colspan="3"><b>GET routes:</b>
            retrieve various types of survivor data.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/get/&lt;survivor_id&gt; </td>
            <td> GET </td>
            <td> Retrieve a serialized version of the survivor.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/get_lineage/&lt;survivor_id&gt; </td>
            <td> GET </td>
            <td> <p>Retrieve a dictionary of survivor family info.</p>
            <p>This method can take a minute to return, as it does recursion,
            initializes all surviviors, living and dead, etc. It's probably
            a good idea to use this one with a loading graphic, etc.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/get_survival_actions/&lt;survivor_id&gt; </td>
            <td> GET </td>
            <td> <p>Retrieve JSON representing the Survival Actions currently
            available to the survivor: </p>
            <pre><code>
    [
        {
            "available": false,
            "sort_order": 0,
            "handle": "dodge",
            "name": "Dodge",
            "type": "survival_action",
            "title_tip": "Impairment 'Broken hip' prevents Wallace from using this ability."
        },
        {
            "available": true,
            "handle": "embolden",
            "name": "Embolden",
            "sort_order": 2,
            "type": "survival_action",
            "title_tip": "Settlement innovation 'Sun Language' unlocks this ability."
        },
        {
            "available": false,
            "handle": "overcharge",
            "name": "Overcharge",
            "sort_order": 5,
            "type": "survival_action",
            "title_tip": "Not unlocked."
        }
    ]</code></pre>
            <p>This JSON is updated automatically whenever the
            the settlement's innovations are update or the survivor's abilities
            are updated.</p>
            </td>
        </tr>


        <!-- asset mgmt -->
        <tr>
            <td class="subsection_header" colspan="3"><p><b>Asset management:</b>
            routes for adding, removing and modifying Survivor Sheet game asset
            info, e.g. Fighting Arts, Disorders, Abilities & Impairments, etc.</p>
            <p><b>Important!</b> Most of these routes have back-end business logic
            "baked" into them, so it is <u>highly recommended</u> that you reload/re-get
            your survivor's JSON after POSTing commands to these routes!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_game_asset/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Use this route to add an asset 'handle' of whatever 'type'
            to a survivor.</p>
            <p>Requires both the 'handle' and 'type' keys:</p>
            <code>{'handle': 'blind', 'type': 'abilities_and_impairments'}</code>
            <code>{'handle': 'crossarm_block', 'type': 'fighting_arts'}</code>
            <p><b>Important!</b> This method enforces many of the incoming
            asset's attributes, including <code>max</code>, <code>epithet</code>,
            and so on.</p>
            <p>PROTIP: if you want the API to assign a random, eligible asset to
            the survivor, use the bogus/magic handle "_random" instead of a
            handle from the settlement's <code>game_assets</code>.</p> 
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_game_asset/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>The exact inverse of <code>add_game_asset</code>, POSTing to
            this route requires both 'handle' and 'type' keys and removes a game
            asset handle from a survivor. </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_many_game_assets/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td>
                <p>This route allows you to add or remove multiple game assets
                from a survivor by POSTing a list of handles/types, as if you
                were doing many <code>add_game_asset</code> or <code>rm_game_asset</code>
                operations serially.</p>
                <p>The JSON you have to POST must include the action you want to
                take:</p>
                <pre><code>{
    "action": "rm",
    "game_assets": [
        {"type": "abilities_and_impairments", "handle": "blind"},
        {"type": "fighting_arts", "handle": "crossarm_block"}
    ]
}</code></pre>
                <p><b>Important!</b> As with <code>set_many_attributes()</code>,
                the hashes in the <code>game_assets</code> list are pressed in
                the order you POST them. YHBW.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/replace_game_assets/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td>
                <p>This route accepts a list of handles and a type of game asset
                and then evalutes the survivor's current handles of that type,
                removing and adding as necessary in order to bring the survivor's
                list in sync with the incoming list. </p>
                <p>Your JSON should look basically like this:</p>
                <pre><code>{
    "type": "abilities_and_impairments",
    "handles": [
        "bitter_frenzy","ageless","analyze"
    ]
}</code></pre>
                <p>You're going to want to also include <code>{"serialize_on_response": true}</code>
                in your POST body on this one, because your survivor is DEFINITELY
                going to come back way different than he was before you did this.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_cursed_item/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p>POST a cursed item 'handle' to this route to add that cursed
            item to the survivor:</p>
            <code>{'handle': 'thunder_maul'}</code>
            <p><b>Important!</b> This will automatically apply any A&Is and
            epithets related to the curse to the survivor.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_cursed_item/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p>POST a cursed item 'handle' to this route to remove that
            cursed item from the survivor:</p>
            <code>{'handle': 'husk_of_destiny'}</code>
            <p><b>Important!</b> This will automatically apply remove any epithets
            A&Is, etc. from the survivor (but will not remove any that are still
            effective, e.g. because another cursed item also requires them.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_special_attribute/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td>
                <p>Use this route to set a survivor special attribute to a
                Boolean value:</p>
                <code>{'handle': 'pots_purified', 'value': false}</code>
                <p>A couple of things to note here:
                <ul>
                    <li>The 'handle' will be validated and if you POST a bad/bogus
                    handle, you'll get a 400 (or worse).</li>
                    <li>The 'value' must be a Boolean/truthy/falsy type value.
                    Anything else will get you a 400 (probably a 500, tbh).</li>
                    <li>Once added to a survivor, this attribute is not removed,
                    so it will forever be a Boolean attrib of the survivor (i.e.
                    so feel free to reference it after setting it False, etc.).</li>
                </ul>
                </p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_weapon_proficiency_type/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p>POST some JSON containing a weapon proficiency type handle
            (from the settlement's <code>game_assets</code> to set it as the
            survivor's weapon type:</p>
            <code>{'handle': 'sword'}</code>
            </td>
        </tr>

        <!-- sheet attribs -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Sheet Attributes:</b>
            routes for updating Survivor Sheet attributes</td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_attribute/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p>Use this route to set an arbitrary survivor attribute to an
            arbitrary value. Requires 'attribute' and 'value' keys.<p>
            <p>POST some JSON containing the 'attrib' name and the new 'value'
            like so:</p>
            <code>{'attribute': 'Strength', 'value': 3}</code>
            <p>The JSON above would set the survivor's Strength to three. The
            'value' should always be an integer. Negative numbers are supported:</p>
            <code>{'attribute': 'Evasion', 'value': -2}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_many_attributes/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td>
                <p>This one works similarly to <code>/survivor/set_attribute/&lt;survivor_id&gt;</code>,
                except it can update a list of attribute key/value pairs.</p>
                <p>The body of your POST should look like this:</p>
                <pre><code>{
    attributes: [
        {attribute: 'Strength', value: 2},
        {attribute: 'survival', value: 5}
    ]
}</code></pre>
                <p><b>Important!</b> Since the <code>attributes</code> array will
                be processed as a Python <code>list</code> type object, attributes
                will be updated synchronously, in the order they are posted.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_attribute_detail/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>All survivors have an <code>attribute_detail</code> element in
            their <code>sheet</code> JSON:</p>
            <code><pre>
        "attribute_detail": {
            "Strength": {
                "tokens": 0,
                "gear": 0
            },
            "Evasion": {
                "tokens": 0,
                "gear": 0
            },
            "Movement": {
                "tokens": 0,
                "gear": 0
            },
            "Luck": {
                "tokens": 0,
                "gear": 0
            },
            "Speed": {
                "tokens": 0,
                "gear": 0
            },
            "Accuracy": {
                "tokens": 1,
                "gear": 0
            }
        },</code></pre>
            <p>This is used to manage attribute info that is NOT the base
            attribute value (see <code>set_attribute</code> and <code>
            update_attribute</code> for updating base values).</p>
            <p>To update <code>attribute_detail</code> info, POST some JSON
            that includes an 'attribute', 'detail' and 'value':</p>
            <code>{'attribute': 'Luck', 'detail': 'tokens', 'value': 2}</code>
            <p>The sample code above would set the survivor's 'Luck' attribute
            detail for 'tokens' to two.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_attribute/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Supports arbitrary survivor attribute updates. Requires JSON
            contianing an 'attribute' and a 'modifier'. Adds the value of
            'modifier' to the current value of 'attribute'.</p>
            <p>Sample JSON to increase strength by two:</p>
            <code>{'attribute': 'Strength', 'modifier': 2}</code>
            <p>Sample JSON to decrease Insanity by 1:</p>
            <code>{'attribute': 'Insanity', 'modifier': -1}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_bleeding_tokens/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p> Use this to add an integer to the survivor's bleeding token
            count:</p>
            <code>{'modifier': -2}</code>
            <p><b>Important!</b> The API will never set the survivor's <code>
            bleeding_tokens</code> value lower than zero or higher than the
            survivor's <code>max_bleeding_tokens</code>. It will return 200's to
            requests that break these rules.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_bleeding_tokens/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p> Use this route to set the survivor's <code>bleeding_tokens</code>
            attribute to an arbitrary integer value.</p>
            <code>{'value': 4}</code>
            <p>Negative values will be ignored (and you'll get a 200 back).</p>
            <p><b>Important!</b> The API will never set the survivor's <code>
            bleeding_tokens</code> value lower than zero or higher than the
            survivor's <code>max_bleeding_tokens</code>. It will return 200's to
            requests that break these rules.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_name/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p>POST some JSON containing the survivor's new name like so:</p>
            <code>{'name': 'Adam'}</code>
            <p><b>Important!</b> POSTing a blank string as the value of 'name'
            will result in the survivor's name defaulting to 'Anonymous':</p>
            <code>{'name': ''}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_retired/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td><p>POST some JSON containing a Boolean value representing whether
            the survivor is retired or not:</p>
            <code>{'retired': true}</code>
            <p>The 'retired' value will be duck-typed to a Boolean, so posting
            anything that evaluates true (e.g. 'checked') will count as a Boolean
            true, for the intents and purposes of this route.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_sex/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Modify the survivor's sex by POSTing a simple JSON object
            containing the key 'sex' and a value of either 'M' or 'F'.</p>
            <code>{'sex': 'M'}</code>
            <p><b>Important!</b> This is not the same as the survivor's
            'effective_sex' attribute, which is mutable. Make sure you're
            modifying the correct one!</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_parent/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Update a survivor's <code>father</code> or <code>mother</code>
            attributes by posting a role (e.g. 'father' or 'mother') plus a valid
            survivor OID to this endpoint:</p>
            <code>{role: 'father', 'oid': 59d78f014af5ca22ab609db2}</code>
            </td>
        </tr>



        <!-- survival -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Survival:</b>
            routes for managing the survivor's Survival value.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_survival/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>POST a 'modifier' integer to this route to add that number
            to the survivor's Survival: </p>
            <code>{"modifier": 2}</code>
            <p>...or:</p>
            <code>{"modifier": -1}</code>
            <p><b>Important!</b> The API will only allow values greater than the
            settlement's Survival Limit if expansion (or other) content requires
            the settlement to NOT enforce Survival Limit.</p>
            <p><b>Important!</b> The API will normalize negative numbers to zero
            automatically.</p> 
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_survival/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>POST a 'value' integer to this route to set that integer as
            the survivor's Survival value.: </p>
            <code>{"value": 6}</code>
            <p><b>Important!</b> The API will only allow values greater than the
            settlement's Survival Limit if expansion (or other) content requires
            the settlement to NOT enforce Survival Limit.</p>
            <p><b>Important!</b> The API will normalize negative numbers to zero
            automatically.</p> 
            </td>
        </tr>


        <!-- specialty/meta -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Specialty routes and
            'meta' data controllers:</b> these routes allow the management of
            data beyond the standard Survivor Sheet fields. These routes
            typically expect detailed/complex JSON, so read carefully!
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/controls_of_death/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>This route is the all-purpose route for managing aspects of
            a survivor's death, including when it happened, how it happened and
            so on. </p>
            <p>Supported key/value info:</p>
            <table class="embedded_table">
             <tr><th>key</th><th><b>R</b>/O</th><th>value</th></tr>
             <tr>
                <td class="key">dead</td>
                <td><b>R</b></td>
                <td class="value">Boolean. Set to 'true' if the survivor is dead.</td>
             </tr><tr>
                <td class="key">died_in</td>
                <td>O</td>
                <td class="value">Integer. The Lantern Year in which the survivor died.</td>
             </tr><tr>
                <td class="key">cause_of_death</td>
                <td>O</td>
                <td class="value">String. Can be anything, but check the settlement's
                assets for some recommended values: <code>game_assets.causes_of_death</code>
                </td>
             </tr>
            </table>
            <p>Here is some example JSON for marking a survivor dead:</p>
            <pre><code>
            {
                "dead": true,
                "died_in": 4,
                "cause_of_death": "Hack City",
            }
            </code></pre>
            <p>To resurrect a survivor (i.e. undo their death), simply post some
            JSON with  <code> {"dead": false} </code>,</p>
            <p>This will unset other death-related attributes, e.g. 'cause_of_death',
            'died_in', etc.</p>
            <p><b>Important!</b> Since <code>dead</code> is the only required key
            in JSON that gets POSTed to this route, there is some defaulting that goes
            on if the other values are undefined. Be as explicit as possible with
            this route.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/update_affinities/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Works with the Survivor's <code>affinities</code> dictionary,
            which contains their permanent, non-token affinities and looks like
            this by default:</p>
            <code>{'red': 0, 'blue': 0, 'green': 0}</code>
            <p>POST some JSON containing an optional 'operation' key whose value
            is 'add' or 'rm' to add or subtract an affinities dictionary called
            'aff_dict' to/from the survivor.</p>
            <p><b>Important!</b> The 'operation' key is optional because the default
            behavior of this method/route is to add the incoming 'aff_dict'.</p>
            <p>For example, if you wanted to add a permanent blue affinity to the
            survivor, you would POST this:</p>
            <code>{'aff_dict': {'blue': 1}}</code>
            <p>Similarly, if you wanted to add two red affinities and subtract
            one green affinity, you would POST a JSON object like this one:</p>
            <code>{'aff_dict': {'red': 2, 'green': -1}, 'operation': 'add'}</code>
            <p>If you wanted to subtract a blue and a green affinity from the
            survivor, you could POST a JSON object like this one:</p>
            <code>{'aff_dict': {'blue': 1, 'green': 1}, 'operation': 'rm'}</code>
            <p><b>Important!</b> The 'operation' key's value must be 'add' or
            'rm'. Anything else will get you a 400 response from this route.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_affinity/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>POST some JSON containing the two required keys, 'color' and
            'value' to set a single survivor affinity to a new integer value.</p>
            <code>{'color': 'blue', 'value': -2}</code>
            <p>The 'value' key must always have an integer value.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_constellation/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>For survivors with Dragon Traits (i.e. PotStars), use this
            route to set their 'constellation':</p>
            <code>{'constellation': 'Witch'}</code>
            <p>Simply POST similar JSON to overwrite/change it:</p>
            <code>{'constellation': 'Absolute'}</code>
            <p>This one also works to unset/remove it:</p>
            <code>{'unset': true}</code>
            <p>Here is a list of accepted/supported values for 'constellation':
            <ul>
                <li>Absolute</li>
                <li>Gambler</li>
                <li>Goblin</li>
                <li>Reaper</li>
                <li>Rust</li>
                <li>Sculptor</li>
                <li>Storm</li>
                <li>Witch</li>
            </ul>
            </p>
            </td>
        </tr>

        <!-- toggles and flgs -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Flags and toggles:</b>
            special routes and methods for setting/unsetting 'flag' type
            aspects of the Settlement Sheet.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_sotf_reroll/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>POST a blank/empty request to this route to toggle the survivor's
            once per lifetime Survival of the Fittest reroll on or off.</p>
            <p><b>Important!</b> The actual attribute of the survivor's <code>
            sheet</code> is <i>sotf_reroll</i>:</p>
            <code>{"sheet": {"sotf_reroll": true, ...}, "meta": {...}, ...}</code>
            <p>But since it is not part of the default data model for survivors,
            it will sometimes simply be undefined/unset, rather than a.) always
            present and b.) always a boolean.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_boolean/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Use this route to toggle Boolean attributes of the survivor
            data model, such as 'public'</p>
            <code>{'attribute': 'public'}</code>
            <p><p><b>Important!</b> These attributes are not the same as <code>
            status flags</code>, which also evaluate Boolean when present on the
            survivor. See <code>set_status_flag</code> and <code>toggle_status_flag</code>
            routes below for info on working with status flags.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_fighting_arts_level/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>The API supports toggling on/off individual levels for
            Survivor Fighting Arts that have levels (e.g. Silk Surgeon). Use
            this route to toggle an individual level on or off by POSTing the
            handle and the level:</p>
            <code>{'handle': 'silk_surgeon', 'level': 2}</code>
            <p>The API does not enforce sequential leveling (i.e. a Survivor can
            have level 3 withing having lower levels, e.g. 1 or 2), so don't
            expect any user-friendliness here.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/set_status_flag/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p> This route and its related route <code>toggle_status_flag</code>
            are used to work with Survivor Sheet 'flags'. The following 'flag'
            attributes can be set to a boolean value:</p>
            <ul>
                <li>cannot_spend_survival</li>
                <li>cannot_use_fighting_arts</li>
                <li>skip_next_hunt</li>
                <li>departing</li>
            </ul>
            <p>To set a flag (i.e. to True/true), POST some JSON to this route
            that includes the 'flag' key with the value of the flag you want to
            set:</p>
            <code>{'flag': 'cannot_spend_survival'}</code>
            <p> To unset/remove a flag, POST the key/value, plus the key 'unset'
            with a value of True/true:</p>
            <code>{'flag': 'skip_next_hunt', 'unset': True}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/toggle_status_flag/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Works nearly identically to <code>set_status_flag</code>
            (see above), except toggles the flag on/off. POST simple JSON
            containing the target 'flag' to toggle it:</p>
            <code>{'flag': 'cannot_use_fighting_arts'}</code>
            </td>
        </tr>

        <!-- misc. and meta -->
        <tr>
            <td class="subsection_header" colspan="3"><b>Meta and admin controls:</b>
            manage survivor meta data, including adding/removing survivor notes,
            etc.</td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_favorite/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Use this route to POST a user's email address and add the address
            to the survivor's <code>favorite</code> list, i.e. the list of users
            who have favorited the Survivor:</p>
            <code>{'user_email': 'demo@kdm-manager.com'}</code>
            <p> This route gracefully fails on bogus requests, so feel free to
            spam it (haha--j/k).</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_favorite/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td> <p>Use this route to POST a user's email address and remove the
            address from the survivor's <code>favorite</code> list, i.e. the
            list of users who have favorited the Survivor:</p>
            <code>{'user_email': 'test@kdm-manager.com'}</code>
            <p> This route gracefully fails on bogus requests and will return a
            a 200 if asked to remove a user that is not currently in the list.</p>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/add_note/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td>
                <p>Adds a text note to a survivor. The note is returned on the
                serliazed survivor (in <code>survivor.notes</codes>).</p>
                <p>The POST body requirements are simple:</p>
                <code>{'note': 'This is my important note about Ugg-Ugg the maker
                of the soup.'}</code>
                <p>Unlike other routes, this one returns the OID of the note:</p> 
                <code>{'note_oid': {$oid: '58703a398740d9730c7abeb2'}}</code>
            </td>
        </tr>
        <tr class="ul">
            <td> /survivor/rm_note/&lt;survivor_id&gt; </td>
            <td> POST </td>
            <td>
                <p>POST an existing note OID to this route to remove it:</p>
                <code>{'_id': '58703a398740d9730c7abeb2'}</code>
            </td>
        </tr>
    </table>


 </body>
</html>
